<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Dan Brown Catalogue RaisonnÃ©{% endblock %}</title>

    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="/api/static/css/output.css">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ¨</text></svg>">

    {% block head %}{% endblock %}
</head>
<body class="min-h-screen">
    <div class="flex h-screen overflow-hidden">

        <!-- Sidebar Navigation -->
        <aside class="w-64 flex-shrink-0 bg-gray-900 border-r border-gray-800 flex flex-col relative z-20">
            <!-- Logo/Brand -->
            <div class="h-20 flex items-center px-6 border-b border-gray-800">
                <a href="/about" class="block group">
                    <h1 class="text-xl font-serif font-semibold text-gray-200 group-hover:text-gold-500 transition-colors">Dan Brown</h1>
                    <span class="text-sm text-gray-500 group-hover:text-gold-500/70 transition-colors">Catalogue RaisonnÃ©</span>
                </a>
            </div>

            <!-- Navigation Links -->
            <nav id="main-nav" class="flex-1 px-3 py-6 space-y-1 overflow-y-auto no-scrollbar">
                <!-- Main Navigation -->
                <a href="/?tab=gallery" class="nav-item" data-nav="gallery">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span>Gallery</span>
                </a>

                <a href="/timeline" class="nav-item {% block nav_timeline %}{% endblock %}" data-nav="timeline">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>Timeline</span>
                </a>

                <a href="/?tab=shows" class="nav-item" data-nav="shows">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                    </svg>
                    <span>Shows</span>
                </a>

                <div class="divider my-4"></div>

                <!-- Tools Section -->
                <a href="/?tab=tracker" class="nav-item" data-nav="tracker">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                    </svg>
                    <span>Tracker</span>
                </a>

                <a href="/outreach" class="nav-item {% block nav_outreach %}{% endblock %}" data-nav="outreach">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                    <span>Outreach</span>
                </a>

                <a href="/discovery" class="nav-item {% block nav_discovery %}{% endblock %}" data-nav="discovery">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <span>Discovery</span>
                </a>

                <a href="/display" class="nav-item {% block nav_display %}{% endblock %}" data-nav="display">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                    <span>Display Frame</span>
                </a>
            </nav>

            <!-- Sidebar Footer -->
            <div class="p-4 border-t border-gray-800">
                <div class="text-xs text-gray-500 space-y-1">
                    <p>Dan Brown (1949-2022)</p>
                    <p class="text-gold-500/70">Trompe l'oeil Master</p>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto bg-gray-850 no-scrollbar">
            {% block content %}{% endblock %}
        </main>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <span id="toast-message"></span>
    </div>

    <!-- Global Scripts -->
    <script>
        // Toast notification system
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');

            toastMessage.textContent = message;
            toast.className = 'toast';

            if (type === 'error') toast.classList.add('error');
            else if (type === 'success') toast.classList.add('success');

            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3500);
        }

        // Escape HTML for XSS prevention
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Format currency
        function formatCurrency(value, currency = 'USD') {
            if (!value) return 'N/A';
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: currency,
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }

        // Debounce utility
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // API helper
        const API = {
            async get(endpoint) {
                const response = await fetch(`/api${endpoint}`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return response.json();
            },

            async post(endpoint, data) {
                const response = await fetch(`/api${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return response.json();
            },

            async patch(endpoint, data) {
                const response = await fetch(`/api${endpoint}`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return response.json();
            },

            async delete(endpoint) {
                const response = await fetch(`/api${endpoint}`, {
                    method: 'DELETE'
                });
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return response.json();
            }
        };

        // Update sidebar navigation active state
        function updateSidebarNav(activeNav) {
            const navItems = document.querySelectorAll('#main-nav .nav-item[data-nav]');
            navItems.forEach(item => {
                if (item.dataset.nav === activeNav) {
                    item.classList.add('nav-item-active');
                } else {
                    item.classList.remove('nav-item-active');
                }
            });
        }

        // Initialize sidebar nav on page load
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const tab = urlParams.get('tab');
            const path = window.location.pathname;

            // Determine active nav based on URL
            if (path === '/outreach') {
                updateSidebarNav('outreach');
            } else if (path === '/alerts') {
                updateSidebarNav('alerts');
            } else if (path === '/display') {
                updateSidebarNav('display');
            } else if (path === '/timeline') {
                updateSidebarNav('timeline');
            } else if (path.startsWith('/artwork/')) {
                updateSidebarNav('tracker');
            } else if (tab === 'gallery') {
                updateSidebarNav('gallery');
            } else if (tab === 'shows') {
                updateSidebarNav('shows');
            } else {
                // Default to tracker
                updateSidebarNav('tracker');
            }
        });
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>
